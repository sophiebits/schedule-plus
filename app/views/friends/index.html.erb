<% content_for :content do %>
<div class="main-aside">
  <!--
  <form>
    <input type="text" placeholder="Search Friends"></input>
    <input type="submit" value="Search"></input>
  </form>
  <ul id="friends-sort-options">
    <li>Sort by Name</li>
    <li>Sort by Courses in Common</li>
  </ul>
  -->
  <a href="#" id="fb-invite">I am a working invite link</a>
  <span class="tooltip">
    Invite your facebook friends to schedule+ to see more schedules!
  </span>
  <script type="text/javascript">

	$(document).ready(function() {

    $('#fb-invite').click(function(e) {
      e.preventDefault();
      FB.ui({ method:'apprequests',
        filters:['app_non_users'],
        title:'Invite Friends to use schedule+!',
        message:'Import your ScheduleMan using schedule+ and share your schedule with me!'
      });
      return false;
    });

		$('.common-courses .tooltip').hide();
		$('.common-courses .tooltip > ul > li').textOverflow();
		
		$('.common-courses .count').hover(
			function() { $(this).prev('.tooltip').show(); }, 
		  function() { $(this).prev('.tooltip').hide(); }
		);
	});
  </script>
</div>
<div id="article">
  <h1 class="friends">Friends</h1>
  <div id="friends">
  <ul id="friends-container">
    <li class="friends-page"><ul>
<% 
###########################################
@friends.order('users.name').each_with_index do |friend, index| 
  if index > 0 && (index % 10) == 0
%>
    </ul></li>
    <li class="friends-page"><ul>
<%   
  end 
%>
    <li class="friend">
      <img src="http://graph.facebook.com/<%= friend.uid %>/picture" />
      <a href="/friends/<%= friend.id %>"><span class="name"><%= friend.name %></span></a>
      <span class="status"><%= friend.status %></span>
      <span class="common-courses">
				<%
					courses_in_common = friend.courses_in_common(current_user)
					if courses_in_common.length > 0
				%>
      	<span class="tooltip">
					<ul>
						<% courses_in_common.each do |course|	%>
						<li><%= course.number + ': ' + course.name %></li>
					<% end %>
					</ul>
				</span>
				<% end %>
				<span class="count"><%= courses_in_common.length %> courses in common</span>
      </span>
    </li>
<% 
end 
###########################################
%>
    </ul></li>
  </ul>
  <span class="nav-previous">previous page</span>
  <span class="nav-next">next page</span>
  </div>
  <script type="text/javascript" src="/javascripts/slider.js"></script>
  <script type="text/javascript">
  $(function() {
    initSlider('#friends','#friends-container','.friends-page',0);
  });
  </script>
</div>
<% end %>
<%= render :partial => 'partials/mainpage' %>
